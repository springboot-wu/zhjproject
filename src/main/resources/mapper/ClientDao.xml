<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zhj.dao.ClientDao" >
<insert id="Add">
      insert into client(id,province,customername,typeid,trader,traderphone,salesman,salescalls,agent,agentnumber) values()
  </insert>
  <update id="Update">
      update  client set province=#{province},customername=#{customername},typeid=#{typeid},trader=#{trader},traderphone=#{traderphone},salesman=#{salesman},salescalls=#{salescalls},agent=#{agent},agentnumber=#{agentnumber}
  </update>
  <delete id="Delete">
      delete  from  client where id=#{id}
  </delete>
    <delete id="BatchDelete">
        delete from  client  where id in
        <foreach collection="array"  item="id" open="(" separator="," close=")"  >
             #{id}
        </foreach>
    </delete>
    <select id="QueryUsers" resultType="com.zhj.model.Deal">
        select  *  from deal where
        <if test="s != null and s != '' ">
          balancedate like #{s}
        </if>
    </select>
    <select id="Password" resultType="com.zhj.model.Users">
        select  * from users where password=#{oldpassword} and id=#{id}
    </select>
    <insert id="AddDeclare">
      insert into  declar(declaretime,electrotime,electro,days,lastmonth,explai,status,usersid,electrotimeho) values(#{declaretime},#{electrotime},#{electro},#{days},#{lastmonth},#{explai},#{status},#{usersid},#{electrotimeho})
    </insert>
 <insert id="AddDeclar">
    insert into  declar(declaretime,electrotime,electro,days,samemoth,explai,status,usersid,electrotimeho) values(#{declaretime},#{electrotime},#{electro},#{days},#{samemoth},#{explai},#{status},#{usersid},#{electrotimeho})
 </insert>
    <select id="Query" resultType="com.zhj.model.Client">
        select * from client c,type y,role  r, user u,user_role s,region r1,region r2,region r3 where c.typeid=y.id and  r.roleid=s.roleid and u.id =s.userid and  c.province=r1.id and r1.id=r2.pid and r2.id=r3.pid and c.userid=u.id
         <if test="p.salesman != null and p.salesman!=0">
           and  c.userid=#{p.salesman}
         </if>
         <if test="p.trader!=null and p.trader!=0">
             and c.userid =#{p.trader}
         </if>
         <if test="p.agent!=null and p.agent!=0">
             and c.userid= #{p.agent}
    </if>
         <if test="p.firm!=null and p.firm !=''">
             and c.customername like #{p.firm}
         </if>

        limit #{page},#{size}
    </select>
<select id="Message" resultType="com.zhj.model.Users">
    select u.name,s.phone,t.typename from users u,client c,user s,role r, user_role o,type t where u.enterpriseid=c.id and c.traderid=s.id and s.id=o.userid and r.roleid=o.roleid and u.id=#{id}  and 	 t.id=u.typeid</select>
    <select id="QueryPassword" resultType="com.zhj.model.Users">
   select * from  users where  id=#{id}
    </select>
    <update id="OldPassword">
        update  users set  password=#{password} where id=#{id}
    </update>
    <select id="More" resultType="com.zhj.model.Deal">
     select * from deal d,declar r where d.declareid=r.id and r.usersid=#{id}
     <if test="p.year!=null and p.year !=''">
       and   d.balancedate like #{p.year}
     </if> order by d.balancedate desc
    </select>
    <select id="da" resultType="java.lang.String">
     select date_add(CURDATE(),interval - day(curdate()) + 5 day)
    </select>
    <select id="time" resultType="java.lang.String">
select date_add(CURDATE(),interval - day(curdate()) + 15 day)
    </select>
    <select id="date" resultType="java.lang.String">
        select date_add(curdate() - day(curdate()) +1,interval 1 month )
    </select>
    <select id="tim" resultType="java.lang.String">
select  last_day(date_add(curdate(),interval 1 month ))
    </select>
    <select id="MoreAndMore" resultType="com.zhj.model.Deal">
      select  * from  deal d,declar r
where d.balancedate>DATE_SUB(CURDATE(), INTERVAL 2 MONTH)and d.declareid=r.id and r.usersid=#{id} order by d.balancedate desc
    </select>
    <select id="History"   resultType="com.zhj.model.Deal">
          select * from deal d,declar r where d.declareid=r.id and r.usersid=#{id}  order by d.balancedate desc
    </select>
    <select id="Total" resultType="java.lang.Integer">
       select count(1) from client c,type y,role  r, user u,user_role s,region r1,region r2,region r3 where c.typeid=y.id and  r.roleid=s.roleid and u.id =s.userid and  c.province=r1.id and r1.id=r2.pid and r2.id=r3.pid and c.userid=u.id
    </select>
    <select id="Trader" resultType="com.zhj.model.User">
   	select u.name from role  r, user u,user_role s where  r.roleid=s.roleid and u.id =s.userid  and r.roleid=1
    </select>
    <select id="Salesman"  resultType="com.zhj.model.User">
    select u.name from role  r, user u,user_role s where  r.roleid=s.roleid and u.id =s.userid  and r.roleid=2
    </select>
    <select id="Agent" resultType="com.zhj.model.User">
         select u.name from role  r, user u,user_role s where  r.roleid=s.roleid and u.id =s.userid  and r.roleid=3
    </select>

</mapper>